<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScientiaGen</title>
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
          "jspdf": "https://esm.sh/jspdf@2.5.1",
          "html2canvas": "https://esm.sh/html2canvas@1.4.1",
          "marked": "https://esm.sh/marked@9.1.2"
        }
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body>

<!-- App Shell -->
<div id="appShell">
    <!-- Sidebar -->
    <aside id="sidebar">
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" id="navHome">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/></svg>
                <span>Página inicial</span>
            </a>
            <div class="user-menu-separator"></div>
            <a href="#" class="nav-item hidden" id="navCards" data-view="cards">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2l-.01-12zM19 16H5V6h14v10z"/></svg>
                <span>Cartões</span>
            </a>
            <a href="#" class="nav-item hidden" id="navSolutions" data-view="solutions">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M14.17 5L19 9.83V19H5V5h9.17M14 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9l-6-6zM8 14h8v2H8v-2zm0-3h8v2H8v-2zm0-3h5v2H8V8z"/></svg>
                <span>Soluções</span>
            </a>
            <a href="#" class="nav-item hidden" id="navExercises" data-view="exercises">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14 10H3v2h11v-2zm0-4H3v2h11V6zm0 8H3v2h11v-2zM21 5l-4 4-4-4 1.41-1.41L17 5.17l2.59-2.58L21 4zM17 21.41L18.41 20l-4-4-4 4 1.41 1.41L15 19.83l2 2.58z"/></svg>
                <span>Exercícios</span>
            </a>
            <a href="#" class="nav-item hidden" id="navReports" data-view="reports">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                <span>Relatórios</span>
            </a>
            <a href="#" class="nav-item hidden" id="navHistory" data-view="history">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.25 2.52.75-1.23-3.5-2.07V8H12z"/></svg>
                <span>Histórico</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="mainContent">
        <!-- Header -->
        <header id="appHeader">
             <button id="headerBackBtn" class="header-btn hidden" title="Voltar">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <div class="header-actions">
                <div id="userProfile" class="user-profile">
                    <button id="userProfileBtn" class="header-btn round-btn" aria-label="Menu do usuário">
                        <!-- SVG for logged out state -->
                        <svg class="logged-out-icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                         <!-- Img for logged in state -->
                        <img src="https://lh3.googleusercontent.com/a/ACg8ocK_s8n1a-2z3rA-YdM4qM-fCH59a2qZ8-rF1GkGv2g=s96-c" alt="Avatar do usuário" class="logged-in-icon hidden"/>
                    </button>
                </div>
            </div>
        </header>

        <!-- Dynamic Content Area -->
        <div id="contentWrapper">

            <!-- Home View (Study Modes) -->
            <div id="homeView">
              <div class="home-header">
                <h2>Como você deseja estudar?</h2>
                <p>Aprenda tudo o que estiver estudando com os cartões interativos, avaliações e atividades de estudos.</p>
              </div>
              <div class="carousel-wrapper">
                <button id="prevBtn" class="carousel-btn" aria-label="Anterior" disabled>
                  <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                </button>
                <div class="carousel">
                    <div class="study-mode-card" id="mode-aprender">
                      <h3>Aprender</h3>
                      <div class="card-preview learn-preview">
                        <div class="learn-card">
                          <span class="learn-text">la pintura</span>
                          <div class="learn-img"></div>
                        </div>
                        <div class="learn-input">Digite a resposta</div>
                      </div>
                    </div>
                    <div class="study-mode-card" id="mode-cartoes">
                      <h3>Cartões</h3>
                      <div class="card-preview cards-preview">
                         <div class="card-stack-item card-stack-item-3"></div>
                         <div class="card-stack-item card-stack-item-2"></div>
                         <div class="card-stack-item card-stack-item-1">
                            <span>veia cava<br/>superior</span>
                            <div class="heart-icon"></div>
                         </div>
                      </div>
                    </div>
                    <div class="study-mode-card" id="mode-combinar">
                      <h3>Combinar</h3>
                      <div class="card-preview match-preview">
                        <div class="match-grid">
                          <div class="match-item"><div class="stomach-icon"></div></div>
                          <div class="match-item"></div>
                          <div class="match-item match-active"><div class="lungs-icon"></div></div>
                          <div class="match-item"></div>
                          <div class="match-item match-correct">✓ pulmões</div>
                          <div class="match-item"></div>
                        </div>
                      </div>
                    </div>
                    <div class="study-mode-card" id="mode-guiada">
                      <h3>Aprendizagem Guiada</h3>
                       <div class="card-preview guided-preview">
                        <div class="guided-path">
                            <div class="path-dot"></div>
                            <div class="path-line"></div>
                            <div class="path-dot active"></div>
                            <div class="path-line"></div>
                            <div class="path-dot"></div>
                        </div>
                      </div>
                    </div>
                     <div class="study-mode-card" id="mode-misto">
                      <h3>Misto</h3>
                      <div class="card-preview misto-preview">
                        <div class="misto-q-mc"><span>Qual é a capital?</span></div>
                        <div class="misto-q-blank"><span>Paris é a ___ da França.</span></div>
                         <div class="misto-q-open"><span>Explique o processo.</span></div>
                      </div>
                    </div>
                </div>
                <button id="nextBtn" class="carousel-btn" aria-label="Próximo" disabled>
                  <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
                </button>
              </div>
            </div>

            <!-- Library View -->
            <div id="libraryView" class="hidden">
                 <div class="library-header">
                    <h1 id="libraryTitle">Sua biblioteca</h1>
                 </div>

                 <div id="libraryContent">
                    <!-- History Tab -->
                    <div id="historyTabContent" class="tab-content hidden">
                        <div class="library-controls">
                            <div class="library-tabs">
                                <button class="tab-btn active" data-filter="all">Todos</button>
                                <button class="tab-btn" data-filter="Cartões">Cartões</button>
                                <button class="tab-btn" data-filter="Aprendizagem Guiada">Soluções</button>
                                <button class="tab-btn" data-filter="Exercises">Exercícios</button>
                            </div>
                            <select id="historySort" class="sort-select">
                                <option value="recent">Mais recentes</option>
                                <option value="oldest">Mais antigos</option>
                            </select>
                        </div>
                        <div class="table-container">
                            <table id="historyTable">
                                <!-- History table will be rendered here -->
                            </table>
                        </div>
                    </div>
                    <!-- Solutions Tab -->
                    <div id="solutionsTabContent" class="tab-content hidden">
                        <!-- Saved solutions will be rendered here -->
                    </div>
                    <!-- Cards Tab -->
                    <div id="cardsTabContent" class="tab-content hidden">
                        <!-- Saved flashcard sets will be rendered here -->
                    </div>
                     <!-- Exercises Tab -->
                    <div id="exercisesTabContent" class="tab-content hidden">
                        <!-- Saved exercises will be rendered here -->
                    </div>
                    <!-- Reports Tab -->
                    <div id="reportsTabContent" class="tab-content hidden">
                        <div class="library-controls">
                             <div class="library-tabs">
                                <button class="tab-btn active" data-filter="all">Todos</button>
                                <button class="tab-btn" data-filter="Aprender">Aprender</button>
                                <button class="tab-btn" data-filter="Combinar">Combinar</button>
                                <button class="tab-btn" data-filter="Misto">Misto</button>
                            </div>
                            <select id="reportSort" class="sort-select">
                                <option value="recent">Mais recentes</option>
                                <option value="oldest">Mais antigos</option>
                            </select>
                        </div>
                        <div id="reportsList">
                             <!-- Saved reports will be rendered here -->
                        </div>
                    </div>
                 </div>
            </div>

            <!-- Individual Study Mode Views (to be toggled) -->
            <div id="studyViewContainer" class="hidden">
                <div id="learnView" class="hidden">
                    <div class="container">
                        <div id="learnSetup">
                            <h1>Modo Aprender</h1>
                            <p>Insira um tópico para gerar um quiz com tempo. Responda às questões abertas e veja sua pontuação no final!</p>
                            <textarea id="learnTopicInput" placeholder="Ex: A Revolução Francesa"></textarea>
                            <button id="startLearnBtn" data-mode="learn">Iniciar</button>
                            <div id="learnMessage" class="error-message"></div>
                        </div>
                        <div id="learnQuiz" class="hidden">
                            <div id="learnHeader">
                                <div id="learnTimer">Tempo: 120</div>
                                <div id="learnProgress">Questão: 1/5</div>
                            </div>
                            <div id="questionContainer"><p id="questionText"></p></div>
                            <textarea id="learnAnswerInput" placeholder="Digite sua resposta..."></textarea>
                            <button id="submitLearnAnswerBtn">Enviar</button>
                            <div id="learnFeedback" class="feedback-message"></div>
                            <div id="learnQuizNav" class="quiz-nav hidden">
                                <button id="learnPrevBtn" class="quiz-nav-btn secondary-btn">&larr; Anterior</button>
                                <button id="learnNextBtn" class="quiz-nav-btn">Próximo &rarr;</button>
                            </div>
                        </div>
                        <div id="learnResults" class="hidden">
                           <div id="learnReportContainer" class="results-report-container">
                                <!-- Detailed report will be rendered here -->
                           </div>
                           <div class="results-actions">
                              <button id="saveLearnReportBtn" class="secondary-btn hidden">Salvar Relatório</button>
                              <button id="saveLearnExerciseBtn" class="secondary-btn hidden">Salvar Exercício</button>
                              <button id="playLearnAgainBtn">Jogar Novamente</button>
                              <button id="newLearnQuizBtn" class="secondary-btn">Novo Quiz</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="flashcardView" class="hidden">
                    <div class="container">
                      <h1>Gerador de Flashcards</h1>
                      <p>Insira um tópico ou uma lista de termos e definições para gerar flashcards.</p>
                      <textarea id="topicInput" placeholder="Ex: Roma Antiga"></textarea>
                      <div class="flashcard-actions">
                          <button id="generateButton">Gerar</button>
                          <button id="viewGeneratedCardsBtn" class="secondary-btn hidden">Exibir</button>
                          <button id="saveFlashcardsBtn" class="secondary-btn hidden">Salvar Cartões</button>
                      </div>
                      <div id="errorMessage" class="error-message"></div>
                      <div id="flashcardsContainer" class="flashcards-container"></div>
                    </div>
                </div>

                <div id="guidedLearningView" class="hidden">
                    <div class="container">
                      <h1>Aprendizagem Guiada</h1>
                      <p>Obtenha soluções passo a passo. Digite um problema ou envie uma foto/documento.</p>
                      <textarea id="problemInput" placeholder="Ex: Qual é a derivada de f(x) = 3x² + 5x - 2?"></textarea>
                      
                      <!-- Attachment Bar -->
                      <div id="guidedAttachmentArea" class="attachment-bar">
                        <input type="file" id="guidedFileInput" accept=".jpg,.jpeg,.png,.pdf,.doc,.docx" class="hidden">
                        <button id="guidedFileBtn" class="secondary-btn icon-only-btn" title="Anexar arquivo">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>
                        </button>
                        <button id="guidedCameraBtn" class="secondary-btn icon-only-btn" title="Tirar foto">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9.4 5L8 6.6h-3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8.6c0-1.1-.9-2-2-2h-3.4L14.6 5h-5.2zM12 17.5c-2.48 0-4.5-2.02-4.5-4.5s2.02-4.5 4.5-4.5 4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7c-1.38 0-2.5 1.12-2.5 2.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5-1.12-2.5-2.5-2.5z"/></svg>
                        </button>
                        
                        <div id="filePreviewArea" class="file-preview hidden">
                            <span id="fileNamePreview">arquivo.jpg</span>
                            <button id="removeFileBtn" class="close-preview-btn">&times;</button>
                        </div>
                      </div>

                      <!-- Camera Preview -->
                      <div id="cameraPreviewArea" class="camera-container hidden">
                          <video id="cameraVideo" autoplay playsinline></video>
                          <canvas id="cameraCanvas" class="hidden"></canvas>
                          <div class="camera-controls">
                              <button id="captureBtn" class="primary-login-btn">Tirar Foto</button>
                              <button id="closeCameraBtn" class="secondary-btn">Cancelar</button>
                          </div>
                      </div>

                      <button id="solveButton">Encontrar Solução</button>
                      <button id="saveSolutionBtn" class="secondary-btn hidden">Salvar Solução</button>
                      <div id="solutionMessage" class="solution-message"></div>
                      <div id="solutionContainer" class="solution-container"></div>
                    </div>
                </div>

                <div id="matchView" class="hidden">
                    <div class="container">
                        <div id="matchSetup">
                            <h1>Jogo de Combinação</h1>
                            <p>Insira um tópico para gerar um jogo de combinação com tempo.</p>
                            <textarea id="matchTopicInput" placeholder="Ex: Capitais do Mundo"></textarea>
                            <button id="startGameBtn" data-mode="match">Iniciar</button>
                            <div id="matchMessage" class="error-message"></div>
                        </div>
                        <div id="matchBoard" class="hidden">
                            <div id="gameHeader">
                                <div id="timer">Tempo: 0s</div>
                                <div id="score">Combinados: 0/6</div>
                            </div>
                            <div id="gameGrid">
                                <div id="termsContainer" class="game-column"></div>
                                <div id="definitionsContainer" class="game-column"></div>
                            </div>
                        </div>
                        <div id="matchResults" class="hidden">
                           <div id="matchReportContainer" class="results-report-container">
                                <!-- Detailed report will be rendered here -->
                           </div>
                           <div class="results-actions">
                              <button id="saveMatchReportBtn" class="secondary-btn hidden">Salvar Relatório</button>
                              <button id="saveMatchExerciseBtn" class="secondary-btn hidden">Salvar Exercício</button>
                              <button id="playAgainBtn">Jogar Novamente</button>
                              <button id="newMatchGameBtn" class="secondary-btn">Novo Jogo</button>
                           </div>
                        </div>
                    </div>
                </div>

                <div id="mistoView" class="hidden">
                    <div class="container">
                        <div id="mistoSetup">
                            <h1>Modo Misto</h1>
                            <p>Insira um tópico para um quiz com diferentes tipos de questões.</p>
                            <textarea id="mistoTopicInput" placeholder="Ex: O Corpo Humano"></textarea>
                            <button id="startMistoBtn" data-mode="misto">Iniciar</button>
                            <div id="mistoMessage" class="error-message"></div>
                        </div>
                        <div id="mistoQuiz" class="hidden">
                            <div id="learnHeader">
                                <div id="mistoTimer">Tempo: 120</div>
                                <div id="mistoProgress">Questão: 1/5</div>
                            </div>
                            <div id="questionContainer"><p id="mistoQuestionText"></p></div>
                            <div id="mistoAnswerOptions"></div>
                            <button id="submitMistoAnswerBtn">Enviar</button>
                            <div id="mistoFeedback" class="feedback-message"></div>
                             <div id="mistoQuizNav" class="quiz-nav hidden">
                                <button id="mistoPrevBtn" class="quiz-nav-btn secondary-btn">&larr; Anterior</button>
                                <button id="mistoNextBtn" class="quiz-nav-btn">Próximo &rarr;</button>
                            </div>
                        </div>
                        <div id="mistoResults" class="hidden">
                           <div id="mistoReportContainer" class="results-report-container">
                                <!-- Detailed report will be rendered here -->
                           </div>
                           <div class="results-actions">
                              <button id="saveMistoReportBtn" class="secondary-btn hidden">Salvar Relatório</button>
                              <button id="saveMistoExerciseBtn" class="secondary-btn hidden">Salvar Exercício</button>
                              <button id="playMistoAgainBtn">Jogar Novamente</button>
                              <button id="newMistoQuizBtn" class="secondary-btn">Novo Quiz</button>
                           </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- ... (Rest of the modals - no changes needed) ... -->
<!-- Login Modal -->
<div id="loginModal" class="modal-overlay hidden">
    <div class="modal-content">
        <button id="closeLoginModalBtn" class="modal-close-btn">&times;</button>
        <h2>Login</h2>
        <p>Faça login para salvar seu progresso e acessar sua biblioteca.</p>
        <form id="loginForm">
            <input id="loginEmailInput" type="email" placeholder="E-mail" required>
            <input id="loginPasswordInput" type="password" placeholder="Senha" required>
            <div id="loginError" class="error-message"></div>
            <button type="submit" class="primary-login-btn">Entrar</button>
        </form>
        <div class="social-login-divider"><span>OU</span></div>
        <button id="googleLoginBtn" class="google-login-btn">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg>
            <span>Entrar com Google</span>
        </button>
    </div>
</div>

<!-- User Profile Modal -->
<div id="userProfileModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeUserProfileModalBtn" class="modal-close-btn">&times;</button>
        <!-- Logged In State -->
        <div id="loggedInUserView" class="hidden">
            <div class="user-menu-header">
                <img id="userInfoAvatar" src="" alt="Avatar do usuário" class="user-info-avatar"/>
                <div class="user-info-details">
                    <div id="userInfoName" class="user-info-name"></div>
                    <div id="userInfoEmail" class="user-info-email"></div>
                </div>
            </div>
            <div class="user-menu-separator"></div>
            <div class="actions-menu">
                <button id="themeToggleBtn" class="user-menu-item">
                    <span id="themeToggleIcon"></span>
                    <span id="themeToggleText"></span>
                </button>
                 <button id="settingsBtn" class="user-menu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.08-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49 1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69.98l2.49 1c.23.08.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                    <span>Configurações</span>
                </button>
                <button id="logoutBtn" class="user-menu-item danger-action">
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none" opacity=".87"/><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                    <span>Sair</span>
                </button>
            </div>
        </div>
        <!-- Logged Out State -->
        <div id="loggedOutUserView" class="hidden">
            <h2>Bem-vindo!</h2>
            <p>Faça login para salvar seu progresso e acessar todos os recursos.</p>
            <div class="actions-menu">
                 <button id="themeToggleBtnLoggedOut" class="user-menu-item">
                    <span id="themeToggleIconLoggedOut"></span>
                    <span id="themeToggleTextLoggedOut"></span>
                </button>
                <button id="loginGoogleBtn" class="user-menu-item">Login com Google</button>
                <button id="loginEmailBtn" class="user-menu-item">Login com E-mail</button>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeSettingsModalBtn" class="modal-close-btn">&times;</button>
        <h2>Configurações</h2>
        <div class="modal-tabs">
            <button class="modal-tab active" data-tab="profile">Perfil</button>
            <button class="modal-tab" data-tab="security">Segurança</button>
            <button class="modal-tab" data-tab="account">Conta</button>
        </div>
        <div class="modal-tab-content active" data-content="profile">
            <form id="profileSettingsForm">
                <h4>Foto de Perfil</h4>
                <div class="avatar-setting">
                    <img id="settingsAvatarPreview" src="" alt="Avatar preview" class="user-info-avatar">
                    <div class="avatar-actions">
                        <input type="file" id="avatarUploadInput" accept="image/*" class="hidden">
                        <button type="button" id="uploadAvatarBtn" class="secondary-btn">Carregar Nova</button>
                        <button type="button" id="removeAvatarBtn" class="danger-action-btn">Remover</button>
                    </div>
                </div>
                <h4>Informações do Perfil</h4>
                <label for="settingsNameInput">Nome</label>
                <input type="text" id="settingsNameInput" required>
                <label for="settingsEmailInput">E-mail</label>
                <input type="email" id="settingsEmailInput" required>
                <button type="submit" class="primary-login-btn">Salvar Alterações de Perfil</button>
            </form>
        </div>
        <div class="modal-tab-content" data-content="security">
            <form id="securitySettingsForm">
                <h4>Alterar Senha</h4>
                <label for="currentPasswordInput">Senha Atual</label>
                <input type="password" id="currentPasswordInput" placeholder="••••••••" required>
                <label for="newPasswordInput">Nova Senha</label>
                <input type="password" id="newPasswordInput" placeholder="••••••••" required>
                <label for="confirmPasswordInput">Confirmar Nova Senha</label>
                <input type="password" id="confirmPasswordInput" placeholder="••••••••" required>
                <button type="submit" class="primary-login-btn">Alterar Senha</button>
            </form>
        </div>
        <div class="modal-tab-content" data-content="account">
            <h4>Excluir Conta</h4>
            <p>Esta ação é permanente. Todos os seus dados, incluindo histórico, cartões e exercícios salvos, serão excluídos e não poderão ser recuperados.</p>
            <button type="button" id="deleteAccountBtn" class="danger-action-btn">Excluir Minha Conta Permanentemente</button>
        </div>
    </div>
</div>


<!-- Pause/Exit Modal -->
<div id="pauseExitModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closePauseExitModalBtn" class="modal-close-btn">&times;</button>
        <h2>Sair do Exercício</h2>
        <p>O que você gostaria de fazer?</p>
        <div class="confirm-actions modal-actions-column">
            <button id="pauseBtn">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                <span>Pausar</span>
            </button>
            <button id="regenerateBtn" class="secondary-btn">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                <span>Gerar Novamente</span>
            </button>
            <button id="giveUpBtn" class="danger-action-btn">
                 <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                <span>Desistir</span>
            </button>
        </div>
    </div>
</div>

<!-- Resume Exercise Modal -->
<div id="resumeExerciseModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeResumeExerciseModalBtn" class="modal-close-btn">&times;</button>
        <h2>Voltar ao Exercício</h2>
        <p>Você tem um exercício pausado. O que gostaria de fazer?</p>
        <div class="confirm-actions modal-actions-column">
            <button id="resumeBtn">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18c.62-.39.62-1.29 0-1.68L9.54 5.98C8.87 5.55 8 6.03 8 6.82z"/></svg>
                <span>Retomar</span>
            </button>
            <button id="regenerateFromPauseBtn" class="secondary-btn">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                <span>Gerar Novamente</span>
            </button>
            <button id="giveUpFromPauseBtn" class="danger-action-btn">
                 <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                <span>Desistir</span>
            </button>
        </div>
    </div>
</div>

<!-- Exit Unsaved Content Modal -->
<div id="exitUnsavedModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeExitUnsavedModalBtn" class="modal-close-btn">&times;</button>
        <h2>Sair da Página</h2>
        <p>Você tem conteúdo não salvo. O que gostaria de fazer?</p>
        <div class="confirm-actions">
            <button id="exitAndDiscardBtn" class="secondary-btn">Sair e Descartar</button>
            <button id="backAndKeepBtn" class="primary-login-btn">Voltar e Manter</button>
        </div>
    </div>
</div>

<!-- Confirm Exit Unsaved Content Modal -->
<div id="confirmExitUnsavedModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeConfirmExitUnsavedModalBtn" class="modal-close-btn">&times;</button>
        <h2>Confirmar Saída</h2>
        <p>Tem certeza que deseja sair? O conteúdo não salvo será perdido.</p>
        <div class="confirm-actions">
            <button id="cancelExitBtn" class="secondary-btn">Cancelar</button>
            <button id="confirmAndExitBtn" class="danger-action-btn">Sair e Descartar</button>
        </div>
    </div>
</div>

<!-- Save Flashcards Modal -->
<div id="saveFlashcardsModal" class="modal-overlay hidden">
    <div class="modal-content">
        <button id="closeSaveFlashcardsModalBtn" class="modal-close-btn">&times;</button>
        <h2>Salvar Flashcards</h2>
        <p>Dê um nome à sua pasta e selecione os cartões que deseja salvar.</p>
        <form id="saveFlashcardsForm">
            <input id="flashcardFolderNameInput" type="text" placeholder="Nome da pasta" required>
            <div id="selectableCardList" class="selectable-list">
                <!-- Selectable cards will be rendered here -->
            </div>
            <button type="submit" class="primary-login-btn">Salvar</button>
        </form>
    </div>
</div>

<!-- Save Exercise Modal -->
<div id="saveExerciseModal" class="modal-overlay hidden">
    <div class="modal-content">
        <button id="closeSaveExerciseModalBtn" class="modal-close-btn">&times;</button>
        <h2>Salvar Exercício</h2>
        <p>Dê um nome a esta pasta de exercícios para praticar mais tarde.</p>
        <form id="saveExerciseForm">
            <input id="exerciseFolderNameInput" type="text" placeholder="Nome da pasta" required>
            <button type="submit" class="primary-login-btn">Salvar</button>
        </form>
    </div>
</div>

<!-- Solution Detail Modal -->
<div id="solutionDetailModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeSolutionDetailModalBtn" class="modal-close-btn">&times;</button>
        
        <!-- Solution Viewer -->
        <div id="solutionDetailViewer">
            <div id="solutionDetailContent">
                <!-- Full solution will be rendered here -->
            </div>
            <div id="solutionDetailFooter" class="modal-footer-actions">
                <div class="user-menu-item-with-submenu">
                     <button id="actionDownloadFromViewer" class="secondary-btn">
                        <span>Baixar</span>
                        <svg class="submenu-arrow" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M7 10l5 5 5-5z"/></svg>
                    </button>
                    <div id="downloadOptionsViewer" class="submenu hidden">
                        <button class="submenu-item" data-format="md">Markdown</button>
                        <button class="submenu-item" data-format="pdf">PDF</button>
                        <button class="submenu-item" data-format="doc">DOC</button>
                    </div>
                </div>
                <button id="actionEditFromViewer" class="primary-login-btn">Editar</button>
            </div>
        </div>

        <!-- Solution Editor (Markdown) -->
        <div id="solutionDetailEditor" class="hidden">
            <h2>Editar Solução (Markdown)</h2>
            <div class="editor-tabs">
                <button class="tab-btn active" data-tab="edit">Edição</button>
                <button class="tab-btn" data-tab="preview">Pré-visualizar</button>
            </div>
            <div class="editor-content-container">
                <div id="markdownEditorArea" class="tab-content active">
                    <textarea id="markdownEditorTextarea"></textarea>
                </div>
                <div id="markdownPreviewArea" class="tab-content hidden solution-container">
                    <!-- Rendered markdown will appear here -->
                </div>
            </div>
            <div class="modal-footer-actions">
                <button id="cancelMarkdownEdit" class="secondary-btn">Cancelar</button>
                <button id="saveMarkdownEdit" class="primary-login-btn">Salvar Alterações</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Card Set Modal -->
<div id="editCardSetModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeEditCardSetModalBtn" class="modal-close-btn">&times;</button>
        <form id="editCardSetForm">
            <h2>Editar Conjunto de Cartões</h2>
            <input id="editCardSetNameInput" type="text" placeholder="Nome da pasta" required>
            <div id="editCardSetList">
                <!-- Editable cards will be rendered here -->
            </div>
            <div class="editor-actions">
                <button type="button" id="addNewCardBtn" class="secondary-btn">Adicionar Novo Cartão</button>
                <button type="submit" class="primary-login-btn">Salvar Alterações</button>
            </div>
        </form>
    </div>
</div>

<!-- Exercise Actions Modal -->
<div id="exerciseActionsModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeExerciseActionsModalBtn" class="modal-close-btn">&times;</button>
        <h2>Ações do Exercício</h2>
        <div class="actions-menu">
            <button id="actionPlayAgain" class="user-menu-item">Jogar Novamente</button>
            <button id="actionEditExercise" class="user-menu-item">Editar</button>
            <button id="actionDeleteExercise" class="user-menu-item danger-action">Excluir</button>
        </div>
    </div>
</div>

<!-- Edit Exercise Modal -->
<div id="editExerciseModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeEditExerciseModalBtn" class="modal-close-btn">&times;</button>
        <form id="editExerciseForm">
            <h2>Editar Exercício</h2>
            <input id="editExerciseNameInput" type="text" placeholder="Nome da pasta" required>
            <div id="editExerciseContent" class="editor-list">
                <!-- Editable exercise content will be rendered here -->
            </div>
             <div class="editor-actions">
                <button type="button" id="addNewExerciseItemBtn" class="secondary-btn">Adicionar Novo Item</button>
                <button type="submit" class="primary-login-btn">Salvar Alterações</button>
            </div>
        </form>
    </div>
</div>

<!-- History Report Modal -->
<div id="historyReportModal" class="modal-overlay hidden">
    <div class="modal-content">
        <button id="closeHistoryReportModalBtn" class="modal-close-btn">&times;</button>
        <h2>Relatório de Desempenho</h2>
        <div id="historyReportContent">
            <!-- Report details will be rendered here -->
        </div>
    </div>
</div>

<!-- Saved Report Viewer Modal -->
<div id="reportViewerModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeReportViewerModalBtn" class="modal-close-btn">&times;</button>
        <div id="reportViewerContent" class="results-report-container">
            <!-- Saved report HTML will be rendered here -->
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div id="confirmDeleteModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeConfirmDeleteModalBtn" class="modal-close-btn">&times;</button>
        <h2 id="confirmDeleteTitle">Confirmar Exclusão</h2>
        <p id="confirmDeleteText">Tem certeza que deseja excluir este item? Esta ação é permanente e não pode ser desfeita.</p>
        <div class="confirm-actions">
            <button id="cancelDeleteBtn" class="secondary-btn">Cancelar</button>
            <button id="confirmDeleteBtn" class="danger-action-btn">Excluir</button>
        </div>
    </div>
</div>

<!-- Solution Actions Modal -->
<div id="solutionActionsModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeSolutionActionsModalBtn" class="modal-close-btn">&times;</button>
        <h2>Ações da Solução</h2>
        <div class="actions-menu">
            <button id="actionViewSolution" class="user-menu-item">Exibir</button>
            <div class="user-menu-item-with-submenu">
                <button id="actionDownloadSolution" class="user-menu-item">
                    <span>Baixar</span>
                    <svg class="submenu-arrow" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <div id="downloadOptionsSolution" class="submenu hidden">
                    <button class="submenu-item" data-format="md">Markdown</button>
                    <button class="submenu-item" data-format="pdf">PDF</button>
                    <button class="submenu-item" data-format="doc">DOC</button>
                </div>
            </div>
            <button id="actionDeleteSolution" class="user-menu-item danger-action">Excluir</button>
        </div>
    </div>
</div>

<!-- Report Actions Modal -->
<div id="reportActionsModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeReportActionsModalBtn" class="modal-close-btn">&times;</button>
        <h2>Ações do Relatório</h2>
        <div class="actions-menu">
            <button id="actionViewReport" class="user-menu-item">Exibir Relatório</button>
            <div class="user-menu-item-with-submenu">
                <button id="actionDownloadReport" class="user-menu-item">
                    <span>Baixar Relatório</span>
                    <svg class="submenu-arrow" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <div id="downloadOptionsReport" class="submenu hidden">
                    <button class="submenu-item" data-format="md">Markdown</button>
                    <button class="submenu-item" data-format="pdf">PDF</button>
                    <button class="submenu-item" data-format="doc">DOC</button>
                </div>
            </div>
            <button id="actionDeleteReport" class="user-menu-item danger-action">Excluir Relatório</button>
        </div>
    </div>
</div>

<!-- Card Actions Modal -->
<div id="cardActionsModal" class="modal-overlay hidden">
    <div class="modal-content small-modal">
        <button id="closeCardActionsModalBtn" class="modal-close-btn">&times;</button>
        <h2>Ações dos Cartões</h2>
        <div class="actions-menu">
            <button id="actionViewCards" class="user-menu-item">Exibir</button>
            <button id="actionEditCards" class="user-menu-item">Editar</button>
            <button id="actionDeleteCards" class="user-menu-item danger-action">Excluir</button>
        </div>
    </div>
</div>

<!-- Card Viewer Modal -->
<div id="cardViewerModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeCardViewerModalBtn" class="modal-close-btn">&times;</button>
        <h2>Visualizador de Cartões</h2>
        <div id="cardViewerContent">
            <!-- Single flashcard will be rendered here -->
        </div>
        <div class="card-viewer-nav">
            <button id="cardViewerPrevBtn" class="secondary-btn">&larr; Voltar</button>
            <span id="cardViewerCounter">1 / 10</span>
            <button id="cardViewerNextBtn" class="primary-login-btn">Próximo &rarr;</button>
        </div>
    </div>
</div>

<!-- Edit Solution Modal -->
<div id="editSolutionModal" class="modal-overlay hidden">
    <div class="modal-content large-modal">
        <button id="closeEditSolutionModalBtn" class="modal-close-btn">&times;</button>
        <form id="editSolutionForm">
            <h2>Editar Solução</h2>
            <label for="editSolutionTitleInput">Título da Solução</label>
            <input id="editSolutionTitleInput" type="text" placeholder="Título da Solução" required>
            
            <div id="editSolutionStepsList" class="editor-list">
                <!-- Editable solution steps will be rendered here -->
            </div>
            
            <button type="button" id="addNewSolutionStepBtn" class="secondary-btn">Adicionar Novo Passo</button>
            
            <hr class="editor-divider">
            
            <label for="editSolutionFinalAnswerInput">Resposta Final</label>
            <textarea id="editSolutionFinalAnswerInput" placeholder="Resposta Final" required></textarea>
            
            <div class="editor-actions">
                <span></span> <!-- Spacer -->
                <button type="submit" class="primary-login-btn">Salvar Alterações</button>
            </div>
        </form>
    </div>
</div>

<!-- Exercise Config Modal -->
<div id="exerciseConfigModal" class="modal-overlay hidden">
    <div class="modal-content">
        <button id="closeExerciseConfigModalBtn" class="modal-close-btn">&times;</button>
        <h2>Configurar Exercício</h2>
        <p>Defina o número de itens e o limite de tempo para a sua sessão.</p>
        <form id="exerciseConfigForm">
            <label for="configItemCount">Número de Questões/Pares</label>
            <input id="configItemCount" type="number" min="3" max="20" value="5" required>
            
            <label for="configTimeLimit">Limite de Tempo (minutos)</label>
            <input id="configTimeLimit" type="number" min="1" max="60" value="2" required>
            
            <button type="submit" class="primary-login-btn">Iniciar</button>
        </form>
    </div>
</div>


<script type="module" src="index.tsx"></script>
</body>
</html>